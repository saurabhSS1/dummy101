It sounds like the newer version of JBoss Modules (1.12.3.Final-redhat-00001) has introduced changes that are causing issues with the keystore used by the Jolokia agent for HTTPS communication. Here are some steps you can try to resolve this issue:

1. Verify Keystore Format and Password

First, ensure that your keystore is in the correct format and the password is correct, as Jolokia may be stricter with newer versions.
	1.	Keystore Format: Ensure the keystore is in PKCS#12 format, as some Java applications, including JBoss and WildFly, handle PKCS#12 keystores more reliably than JKS in newer versions.
You can convert an existing JKS keystore to PKCS#12 format with this command:

keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.p12 -deststoretype PKCS12


	2.	PKCS#8 Encoding: Ensure that any private keys in the keystore are in PKCS#8 format, as JBoss may require this in newer versions. You can convert a private key to PKCS#8 format if necessary (see previous instructions for using openssl to convert the private key).
	3.	Verify the Password: Double-check that the password in your configuration matches the password of the keystore. If the password is incorrect, Jolokia won’t be able to access the keystore.

2. Update Jolokia Configuration for HTTPS

Ensure that your Jolokia configuration in JBoss is correctly set up for HTTPS, as some configuration parameters may have changed in the newer version of JBoss Modules. Check your Jolokia configuration (usually in standalone.xml, domain.xml, or as JVM options) and ensure it points to the correct keystore location and password.

For example, you might have JVM options like this:

-Djolokia.config=httpsKeyStore=/opt/server-certs/keystore.p12
-Djolokia.config=httpsKeyStorePassword=your_keystore_password
-Djolokia.config=httpsKeyStoreType=PKCS12

Ensure the following configurations:
	•	httpsKeyStore points to the correct path of your keystore.
	•	httpsKeyStorePassword is the correct password.
	•	httpsKeyStoreType is set to PKCS12 if you’re using a PKCS12 keystore.

3. Permissions and Mount Path in OpenShift

Ensure that the keystore is correctly mounted in OpenShift and has the appropriate permissions. In your pod, verify:
	1.	The keystore is accessible at the specified path (e.g., /opt/server-certs/keystore.p12):

ls -l /opt/server-certs/keystore.p12


	2.	The user running JBoss has the necessary permissions to read the keystore file.

4. Check for Compatibility Issues with Jolokia and JBoss Modules

Since you mentioned that it works with jboss-modules 1.12.0.Final but fails with 1.12.3.Final, it’s possible that the Jolokia version or configuration you’re using has compatibility issues with the newer version of JBoss Modules.
	•	Upgrade Jolokia: Make sure you’re using a compatible version of Jolokia that works with 1.12.3.Final. Newer versions of JBoss Modules might require an updated version of Jolokia.
	•	Downgrade JBoss Modules (Temporary Solution): If possible, use 1.12.0.Final until a compatible configuration or version of Jolokia is available for 1.12.3.Final.

5. Check for JBoss and Jolokia Logs

Review the logs carefully for any additional details. Sometimes Jolokia provides more specific information about why it can’t access the keystore. Look for entries related to Jolokia, HTTPS configuration, or SSL/TLS initialization.
	•	Enable Debug Logging: If possible, enable debug logging for JBoss and Jolokia to get more details about the error. This can often reveal specific configuration issues.

6. Recreate the Keystore if Necessary

If all else fails, consider recreating the keystore from scratch, making sure it’s in PKCS#12 format and contains only PKCS#8 encoded keys. This can sometimes resolve underlying issues with keystore integrity or configuration.

Summary Checklist

	•	Confirm keystore is in PKCS#12 format.
	•	Verify private key(s) in PKCS#8 encoding.
	•	Double-check keystore password.
	•	Ensure correct Jolokia configuration for HTTPS.
	•	Ensure correct keystore permissions in OpenShift.
	•	Verify compatibility between Jolokia and jboss-modules 1.12.3.Final.

If these steps don’t resolve the issue, please let me know if there are any additional details in the logs, and I can help troubleshoot further.
